services:
  recorder:
    build: .
    container_name: gaze_capture
    network_mode: host

    # --- Allow outbound requests to localhost ---
    extra_hosts:
      - "host.docker.internal:host-gateway"

    # --- Eye Tracker Access ---
    devices:
      - "/dev/udev/tobii_pro_fusion:/dev/udev/tobii_pro_fusion"

    # --- GUI Forwarding Configuration ---
    environment:
      - DISPLAY=${DISPLAY}
      - GAZE__DATA_DIR=/app/recordings
      - GAZE__ZMQ__HOST=tcp://*:5555
      - GAZE__LOGGING__LEVEL=INFO

      # Screen dimensions
      - GAZE__DISPLAY_AREA__WIDTH_MM=960
      - GAZE__DISPLAY_AREA__HEIGHT_MM=560
      - GAZE__DISPLAY_AREA__VERTICAL_OFFSET_MM=60
      - GAZE__DISPLAY_AREA__HORIZONTAL_OFFSET_MM=0
      - GAZE__DISPLAY_AREA__DEPTH_OFFSET_MM=0

    # --- Volumes ---
    volumes:
      # For communicating with the X server
      - /tmp/.X11-unix:/tmp/.X11-unix
      # For authenticating with the X server
      - ~/.Xauthority:/root/.Xauthority:ro
      # Symlinks to devices mounted with udev
      - /dev/udev:/dev/udev
      
      # --- Data Persistence ---
      - ./recordings:/app/recordings